<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaVault - Gói dịch vụ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="assets/img/logo.webp" alt="MediaVault Logo">
                    <span>MediaVault</span>
                </div>
                <nav>
                    <ul class="nav-links">
                        <li><a href="index.html"><i class="fas fa-home"></i> Trang chủ</a></li>
                        <li><a href="check.html"><i class="fas fa-search"></i> Kiểm tra</a></li>
                        <li><a href="history.html"><i class="fas fa-history"></i> Lịch sử</a></li>
                        <li><a href="storage.html"><i class="fas fa-hdd"></i> Lưu trữ</a></li>
                        <li><a href="subscription.html" class="active"><i class="fas fa-crown"></i> Gói dịch vụ</a></li>
                        <li class="guest-only"><a href="#" id="login-link" class="btn btn-outline"><i
                                    class="fas fa-sign-in-alt"></i> Đăng nhập</a></li>
                        <li class="guest-only"><a href="#" id="register-link" class="btn btn-primary"><i
                                    class="fas fa-user-plus"></i> Đăng ký</a></li>
                        <li class="user-only" style="display: none;">
                            <div class="user-dropdown">
                                <div class="user-icon">
                                    <i class="fas fa-user-circle"></i>
                                    <span id="username-display"></span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="dropdown-content">
                                    <a href="#" id="profile-link"><i class="fas fa-user"></i> Hồ sơ</a>
                                    <a href="#" id="settings-link"><i class="fas fa-cog"></i> Cài đặt</a>
                                    <a href="#" id="logout-link"><i class="fas fa-sign-out-alt"></i> Đăng xuất</a>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <div class="hamburger">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <section class="section subscription-section">
        <div class="container">
            <h2 class="section-title">Gói dịch vụ</h2>
            <p class="section-desc">Chọn gói dịch vụ phù hợp với nhu cầu của bạn</p>

            <div class="plans-container">
                <div class="plan-card" id="free-plan">
                    <div class="plan-header">
                        <h3>Miễn phí</h3>
                        <div class="plan-price">
                            <span class="price">0</span>
                            <span class="currency">VNĐ</span>
                            <span class="period">/tháng</span>
                        </div>
                    </div>
                    <div class="plan-features">
                        <ul>
                            <li><i class="fas fa-check"></i> 10 lượt kiểm tra mỗi tháng</li>
                            <li><i class="fas fa-check"></i> Kiểm tra văn bản</li>
                            <li><i class="fas fa-check"></i> Lưu lịch sử 7 ngày</li>
                            <li class="feature-disabled"><i class="fas fa-times"></i> Kiểm tra tệp</li>
                            <li class="feature-disabled"><i class="fas fa-times"></i> Kiểm tra hình ảnh/video</li>
                        </ul>
                    </div>
                    <div class="plan-footer">
                        <button class="btn btn-outline" id="current-plan" style="display:none;">Gói hiện tại</button>
                        <button class="btn btn-primary select-plan-btn" data-plan="free">Chọn gói</button>
                    </div>
                </div>

                <div class="plan-card" id="basic-plan">
                    <div class="plan-header">
                        <h3>Cơ bản</h3>
                        <div class="plan-price">
                            <span class="price">99.000</span>
                            <span class="currency">VNĐ</span>
                            <span class="period">/tháng</span>
                        </div>
                    </div>
                    <div class="plan-features">
                        <ul>
                            <li><i class="fas fa-check"></i> 50 lượt kiểm tra mỗi tháng</li>
                            <li><i class="fas fa-check"></i> Kiểm tra văn bản</li>
                            <li><i class="fas fa-check"></i> Kiểm tra tệp</li>
                            <li><i class="fas fa-check"></i> Lưu lịch sử 30 ngày</li>
                            <li class="feature-disabled"><i class="fas fa-times"></i> Kiểm tra hình ảnh/video</li>
                        </ul>
                    </div>
                    <div class="plan-footer">
                        <button class="btn btn-outline" id="current-plan" style="display:none;">Gói hiện tại</button>
                        <button class="btn btn-primary select-plan-btn" data-plan="basic">Chọn gói</button>
                    </div>
                </div>

                <div class="plan-card popular" id="premium-plan">
                    <div class="popular-tag">Phổ biến</div>
                    <div class="plan-header">
                        <h3>Cao cấp</h3>
                        <div class="plan-price">
                            <span class="price">199.000</span>
                            <span class="currency">VNĐ</span>
                            <span class="period">/tháng</span>
                        </div>
                    </div>
                    <div class="plan-features">
                        <ul>
                            <li><i class="fas fa-check"></i> 200 lượt kiểm tra mỗi tháng</li>
                            <li><i class="fas fa-check"></i> Tất cả tính năng kiểm tra</li>
                            <li><i class="fas fa-check"></i> Kiểm tra hình ảnh & video</li>
                            <li><i class="fas fa-check"></i> Lưu lịch sử không giới hạn</li>
                            <li><i class="fas fa-check"></i> Hỗ trợ qua email</li>
                        </ul>
                    </div>
                    <div class="plan-footer">
                        <button class="btn btn-outline" id="current-plan" style="display:none;">Gói hiện tại</button>
                        <button class="btn btn-primary select-plan-btn" data-plan="premium">Chọn gói</button>
                    </div>
                </div>

                <div class="plan-card" id="business-plan">
                    <div class="plan-header">
                        <h3>Doanh nghiệp</h3>
                        <div class="plan-price">
                            <span class="price">499.000</span>
                            <span class="currency">VNĐ</span>
                            <span class="period">/tháng</span>
                        </div>
                    </div>
                    <div class="plan-features">
                        <ul>
                            <li><i class="fas fa-check"></i> 1000 lượt kiểm tra mỗi tháng</li>
                            <li><i class="fas fa-check"></i> Tất cả tính năng premium</li>
                            <li><i class="fas fa-check"></i> API truy cập</li>
                            <li><i class="fas fa-check"></i> Hỗ trợ ưu tiên 24/7</li>
                            <li><i class="fas fa-check"></i> Báo cáo chi tiết</li>
                        </ul>
                    </div>
                    <div class="plan-footer">
                        <button class="btn btn-outline" id="current-plan" style="display:none;">Gói hiện tại</button>
                        <button class="btn btn-primary select-plan-btn" data-plan="business">Chọn gói</button>
                    </div>
                </div>
            </div>

            <div class="subscription-info">
                <div class="user-plan-info user-only" style="display: none;">
                    <h3>Gói dịch vụ của bạn</h3>
                    <div class="current-plan-details">
                        <p><strong>Gói hiện tại:</strong> <span id="current-plan-name">Free</span></p>
                        <p><strong>Số lượt kiểm tra còn lại:</strong> <span id="checks-remaining">0</span></p>
                        <p><strong>Tính năng:</strong> <span id="plan-features">Basic features</span></p>
                    </div>
                </div>

                <div class="guest-only login-prompt">
                    <div class="login-prompt-content">
                        <i class="fas fa-lock"></i>
                        <h3>Vui lòng đăng nhập</h3>
                        <p>Bạn cần đăng nhập để đăng ký gói dịch vụ.</p>
                        <div class="prompt-actions">
                            <a href="#" id="subscription-login-link" class="btn btn-primary">Đăng nhập</a>
                            <a href="#" id="subscription-register-link" class="btn btn-outline">Đăng ký</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="modal" id="payment-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="paymentView.closeModal('payment-modal')"><i
                    class="fas fa-times"></i></span>
            <h3>Thanh toán <span id="selected-plan-name">Gói dịch vụ</span></h3>
            <form id="payment-form">
                <input type="hidden" id="selected-plan" value="">

                <div class="form-group">
                    <label>Tổng tiền thanh toán:</label>
                    <div class="payment-total" id="payment-amount">0 VNĐ</div>
                </div>

                <div class="form-group">
                    <label for="payment-method">Phương thức thanh toán</label>
                    <select id="payment-method" class="form-control">
                        <option value="bank">Chuyển khoản ngân hàng</option>
                        <option value="momo">Ví MoMo</option>
                        <option value="vnpay">VNPay</option>
                        <option value="card">Thẻ tín dụng/ghi nợ</option>
                    </select>
                </div>

                <div id="bank-details" class="payment-details">
                    <div class="form-group">
                        <label>Thông tin chuyển khoản</label>
                        <div class="bank-info">
                            <p><strong>Ngân hàng:</strong> MB Bank</p>
                            <p><strong>Số tài khoản:</strong> 039175309</p>
                            <p><strong>Chủ tài khoản:</strong> MEDIAVAULT CO., LTD</p>
                            <p><strong>Nội dung chuyển khoản:</strong> <span id="payment-ref">MV12345</span></p>
                            <div class="payment-note">
                                <i class="fas fa-info-circle"></i>
                                <p>Lưu ý: Mã giao dịch sẽ được mã hóa theo gói dịch vụ đã chọn (B001 cho gói Cơ bản,
                                    P001 cho gói Premium, v.v.).</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="card-details" class="payment-details" style="display: none;">
                    <div class="form-group">
                        <label for="card-number">Số thẻ</label>
                        <input type="text" id="card-number" placeholder="XXXX XXXX XXXX XXXX" class="form-control">
                    </div>
                    <div class="form-row">
                        <div class="form-group half">
                            <label for="card-expiry">Ngày hết hạn</label>
                            <input type="text" id="card-expiry" placeholder="MM/YY" class="form-control">
                        </div>
                        <div class="form-group half">
                            <label for="card-cvc">CVC</label>
                            <input type="text" id="card-cvc" placeholder="CVC" class="form-control">
                        </div>
                    </div>
                </div>

                <div id="ewallet-details" class="payment-details" style="display: none;">
                    <div class="form-group">
                        <label>Quét mã QR</label>
                        <div class="qr-code">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1 1'%3E%3C/svg%3E"
                                data-src="assets/img/qr-placeholder.png" alt="QR Code" id="payment-qr" loading="lazy"
                                class="lazy-image">
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-block">Xác nhận thanh toán</button>
            </form>
        </div>
    </div>

    <div class="modal" id="login-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="authView.closeModal('login-modal')"><i class="fas fa-times"></i></span>
            <h3>Đăng nhập</h3>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" placeholder="Nhập email" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Mật khẩu</label>
                    <input type="password" id="login-password" placeholder="Nhập mật khẩu" required>
                </div>
                <button type="submit" class="btn btn-primary">Đăng nhập</button>
                <p style="text-align: center; margin-top: 1rem;">Chưa có tài khoản? <a href="#"
                        id="switch-to-register">Đăng ký ngay</a></p>
            </form>
        </div>
    </div>

    <div class="modal" id="register-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="authView.closeModal('register-modal')"><i class="fas fa-times"></i></span>
            <h3>Đăng ký</h3>
            <form id="register-form">
                <div class="form-group">
                    <label for="register-username">Tên người dùng</label>
                    <input type="text" id="register-username" placeholder="Nhập tên người dùng" required>
                </div>
                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" placeholder="Nhập email" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Mật khẩu</label>
                    <input type="password" id="register-password" placeholder="Nhập mật khẩu" required>
                </div>
                <div class="form-group">
                    <label for="register-confirm-password">Xác nhận mật khẩu</label>
                    <input type="password" id="register-confirm-password" placeholder="Nhập lại mật khẩu" required>
                </div>
                <button type="submit" class="btn btn-primary">Đăng ký</button>
                <p style="text-align: center; margin-top: 1rem;">Đã có tài khoản? <a href="#" id="switch-to-login">Đăng
                        nhập</a></p>
            </form>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>MediaVault</h4>
                    <p>Nền tảng kiểm tra trùng lặp thông minh với công nghệ AI tiên tiến. Bảo vệ tính nguyên bản của nội
                        dung của bạn.</p>
                </div>
                <div class="footer-section">
                    <h4>Liên kết</h4>
                    <ul>
                        <li><a href="index.html">Trang chủ</a></li>
                        <li><a href="check.html">Kiểm tra</a></li>
                        <li><a href="history.html">Lịch sử</a></li>
                        <li><a href="storage.html">Lưu trữ</a></li>
                        <li><a href="subscription.html">Gói dịch vụ</a></li>
                        <li><a href="#">Về chúng tôi</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Liên hệ</h4>
                    <p><i class="fas fa-envelope"></i> Email: support@mediavault.com</p>
                    <p><i class="fas fa-phone-alt"></i> Hotline: 0123 456 789</p>
                    <p><i class="fas fa-map-marker-alt"></i> Địa chỉ: Hà Nội, Việt Nam</p>
                </div>
                <div class="footer-section">
                    <h4>Theo dõi chúng tôi</h4>
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <a href="#" style="font-size: 1.5rem;"><i class="fab fa-facebook"></i></a>
                        <a href="#" style="font-size: 1.5rem;"><i class="fab fa-twitter"></i></a>
                        <a href="#" style="font-size: 1.5rem;"><i class="fab fa-instagram"></i></a>
                        <a href="#" style="font-size: 1.5rem;"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>© 2023 MediaVault. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="assets/js/utils/performance.js"></script>
    <script src="assets/js/utils/email.js"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/api/mongodb.js"></script>
    <script src="assets/js/api/plagiarism.js"></script>
    <script src="assets/js/model/userModel.js"></script>
    <script src="assets/js/model/fileModel.js"></script>
    <script src="assets/js/view/authView.js"></script>
    <script src="assets/js/view/mainView.js"></script>
    <script src="assets/js/view/paymentView.js"></script>
    <script src="assets/js/controller/authController.js"></script>
    <script src="assets/js/controller/mainController.js"></script>
    <script src="assets/js/controller/paymentController.js"></script>
    <script src="assets/js/controller/subscriptionController.js"></script>
    <script src="assets/js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const userModel = new UserModel();
            const paymentView = new PaymentView();
            const subscriptionController = new SubscriptionController(userModel, paymentView);

            // Khởi tạo controllers
            window.subscriptionController = subscriptionController;
            window.paymentView = paymentView;

            // Khởi tạo kết nối MongoDB
            if (!window.mongoDB && window.CONFIG) {
                window.mongoDB = new MongoDB({
                    apiKey: window.CONFIG.MONGODB_API_KEY,
                    privateKey: window.CONFIG.MONGODB_PRIVATE_KEY,
                    connectionString: window.CONFIG.MONGODB_CONNECTION_STRING,
                    database: window.CONFIG.MONGODB_DATABASE,
                    dataSource: window.CONFIG.MONGODB_DATA_SOURCE
                });
            }

            // Đăng ký sự kiện cho các nút chọn gói
            document.querySelectorAll('.select-plan-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    subscriptionController.handleUpgrade(e);
                });
            });

            // Thiết lập sự kiện cho đăng nhập/đăng xuất
            const loginLink = document.getElementById('login-link');
            const registerLink = document.getElementById('register-link');
            const subscriptionLoginLink = document.getElementById('subscription-login-link');
            const subscriptionRegisterLink = document.getElementById('subscription-register-link');
            const logoutLink = document.getElementById('logout-link');

            if (loginLink) {
                loginLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.href = 'login.html';
                });
            }

            if (registerLink) {
                registerLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.href = 'register.html';
                });
            }

            if (subscriptionLoginLink) {
                subscriptionLoginLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.href = 'login.html';
                });
            }

            if (subscriptionRegisterLink) {
                subscriptionRegisterLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.href = 'register.html';
                });
            }

            if (logoutLink) {
                logoutLink.addEventListener('click', async (e) => {
                    e.preventDefault();
                    await userModel.logout();
                    window.location.href = 'index.html';
                });
            }

            // Lắng nghe sự kiện cập nhật người dùng
            window.addEventListener('user-updated', (event) => {
                if (event.detail && event.detail.user) {
                    console.log('User data updated, refreshing display');
                    subscriptionController.updateUserDisplay(event.detail.user);
                }
            });

            // Lắng nghe sự kiện cập nhật gói dịch vụ
            window.addEventListener('subscription-updated', (event) => {
                if (event.detail && event.detail.user && event.detail.plan) {
                    console.log(`Subscription updated to ${event.detail.plan}`);
                    subscriptionController.updateUserDisplay(event.detail.user);
                    subscriptionController.highlightCurrentPlan(event.detail.plan);
                }
            });

            // Khởi tạo và kiểm tra đăng nhập
            subscriptionController.initializePage();
        });
    </script>
</body>

</html>